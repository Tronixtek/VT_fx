# VTfx Deployment Guide

## Prerequisites

1. **GitHub Account**: https://github.com
2. **Render Account**: https://render.com (sign up with GitHub)
3. **MongoDB Atlas Account**: https://www.mongodb.com/cloud/atlas (for production database)

## Step 1: Push to GitHub

1. **Create a new repository on GitHub**:
   - Go to https://github.com/new
   - Name: `vtfx-trading-platform` (or your preferred name)
   - Make it **Private** (recommended) or Public
   - Don't initialize with README (you already have one)
   - Click "Create repository"

2. **Push your code**:
   ```bash
   # Add remote (replace YOUR_USERNAME with your GitHub username)
   git remote add origin https://github.com/YOUR_USERNAME/vtfx-trading-platform.git
   
   # Commit your changes
   git commit -m "Initial commit - VTfx Trading Platform"
   
   # Push to GitHub
   git push -u origin main
   ```

## Step 2: Set Up MongoDB Atlas (Production Database)

1. **Create a free cluster**:
   - Go to https://www.mongodb.com/cloud/atlas
   - Sign up / Log in
   - Create a **FREE** M0 cluster
   - Choose a region close to your users
   - Name it `vtfx-production`

2. **Configure database access**:
   - Go to "Database Access" â†’ "Add New Database User"
   - Username: `vtfx-admin`
   - Password: Generate a strong password (save it!)
   - Database User Privileges: **Atlas Admin**

3. **Configure network access**:
   - Go to "Network Access" â†’ "Add IP Address"
   - Click **"Allow Access from Anywhere"** (0.0.0.0/0)
   - Confirm

4. **Get connection string**:
   - Go to "Database" â†’ Click "Connect"
   - Choose "Connect your application"
   - Copy the connection string
   - Replace `<password>` with your database password
   - Example: `mongodb+srv://vtfx-admin:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/vtfx?retryWrites=true&w=majority`

## Step 3: Deploy to Render

### Option A: Using render.yaml (Recommended - Deploys Both Frontend & Backend)

1. **Go to Render Dashboard**: https://dashboard.render.com

2. **Create New Blueprint**:
   - Click "New" â†’ "Blueprint"
   - Connect your GitHub account
   - Select your `vtfx-trading-platform` repository
   - Render will detect the `render.yaml` file
   - Click "Apply"

3. **Configure Environment Variables** (for vtfx-api service):
   
   Click on **vtfx-api** service and add these environment variables:
   
   ```
   MONGO_URI = <Your MongoDB Atlas connection string>
   JWT_SECRET = <Auto-generated by Render>
   JWT_REFRESH_SECRET = <Auto-generated by Render>
   PAYSTACK_SECRET_KEY = sk_test_397af4fa96e98a07850cba8424ff85eee69b12dc
   PAYSTACK_PUBLIC_KEY = pk_test_f8065e7cacdea674402042b0d99797e41e809507
   CLIENT_URL = <Your frontend URL from Render> (e.g., https://vtfx-client.onrender.com)
   ```

4. **Configure Environment Variables** (for vtfx-client service):
   
   Click on **vtfx-client** service and add:
   
   ```
   VITE_API_URL = <Your backend URL from Render> (e.g., https://vtfx-api.onrender.com)
   ```

5. **Deploy**:
   - Both services will start building automatically
   - Backend typically takes 3-5 minutes
   - Frontend typically takes 2-3 minutes

### Option B: Manual Deployment (Deploy Services Separately)

#### Deploy Backend:

1. Click "New" â†’ "Web Service"
2. Connect GitHub repository
3. Configure:
   - **Name**: `vtfx-api`
   - **Region**: Frankfurt (or closest to you)
   - **Branch**: `main`
   - **Root Directory**: `server`
   - **Environment**: `Node`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free

4. Add environment variables (same as above)

#### Deploy Frontend:

1. Click "New" â†’ "Static Site"
2. Connect same GitHub repository
3. Configure:
   - **Name**: `vtfx-client`
   - **Region**: Frankfurt
   - **Branch**: `main`
   - **Root Directory**: `client`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `dist`

4. Add environment variable:
   ```
   VITE_API_URL = <Your backend URL>
   ```

## Step 4: Seed Production Database

1. **SSH into backend service** (or use local connection):
   ```bash
   # Update MONGO_URI in .env to point to production MongoDB
   # Then run:
   npm run seed
   ```

2. **Or run seed script manually**:
   - Go to Render Shell for your backend service
   - Run: `cd src/scripts && node seed.js`

## Step 5: Configure Paystack Webhook (Optional but Recommended)

1. **Go to Paystack Dashboard**: https://dashboard.paystack.com
2. **Settings** â†’ **Webhooks**
3. **Add Webhook URL**: `https://your-backend-url.onrender.com/api/payments/webhook`
4. **Copy Webhook Secret** and add to Render environment variables

## Step 6: Test Your Deployment

1. **Visit your frontend URL**: `https://vtfx-client.onrender.com`
2. **Test login** with seeded accounts:
   - Admin: `admin@vtfx.com` / `admin123`
   - User: `user.basic@vtfx.com` / `user123`
3. **Test payment flow** with Paystack test cards

## Important Notes

### Free Tier Limitations

- **Render Free Tier**:
  - Services sleep after 15 minutes of inactivity
  - First request after sleep takes ~30 seconds to wake up
  - 750 hours/month free (enough for 1 service 24/7)

- **MongoDB Atlas Free Tier**:
  - 512 MB storage
  - Shared CPU
  - No backups (on free tier)

### Production Checklist

- [ ] Use **strong passwords** for MongoDB
- [ ] Keep `.env` files out of git (already in .gitignore)
- [ ] Switch Paystack from **test** to **live** keys for production
- [ ] Enable CORS only for your frontend domain (not *)
- [ ] Set up **custom domain** (optional)
- [ ] Configure **Paystack webhook**
- [ ] Set up **error monitoring** (e.g., Sentry)
- [ ] Enable **MongoDB backups**

## Troubleshooting

### Backend won't start:
- Check Render logs for errors
- Verify all environment variables are set
- Ensure MongoDB connection string is correct

### Frontend shows API errors:
- Verify `VITE_API_URL` is set correctly
- Check CORS settings in backend
- Ensure backend is running

### Database connection failed:
- Verify MongoDB Atlas IP whitelist (0.0.0.0/0)
- Check username and password in connection string
- Ensure database user has correct permissions

### Payments not working:
- Verify Paystack keys are correct
- Check CLIENT_URL is set to frontend URL
- Configure webhook in Paystack dashboard

## Updating Your Deployment

When you make changes:

```bash
# Commit changes
git add .
git commit -m "Your commit message"
git push origin main
```

Render will automatically detect changes and redeploy both services!

## Support

- **Render Docs**: https://render.com/docs
- **MongoDB Atlas Docs**: https://docs.atlas.mongodb.com
- **Paystack Docs**: https://paystack.com/docs

---

**Your VTfx Trading Platform is ready for production! ðŸš€**
